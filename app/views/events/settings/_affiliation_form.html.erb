<%# locals: (affiliation:, form:) %>

<% disabled = !policy(affiliation).update? %>

<fieldset class="field">
  <legend class="font-medium">Type</legend>
  <p class="h5 muted mt-0 mb-3">
    Which organization are you affiliated with, if any?
  </p>
  <div class="field field--options field--green trio mb-0">
    <%= form.radio_button :type, :first, disabled:, "x-model": "type" %>
    <%= form.label :type, value: :first do %>
      <%= inline_icon "sam", size: 28 %>
      <strong>FIRST Robotics</strong>
    <% end %>
    <%= form.radio_button :type, :vex, disabled:, "x-model": "type" %>
    <%= form.label :type, value: :vex do %>
      <%= inline_icon "sam", size: 32 %>
      <strong>VEX Robotics</strong>
    <% end %>
    <%= form.radio_button :type, :hack_club, disabled:, "x-model": "type" %>
    <%= form.label :type, value: :hack_club do %>
      <%= inline_icon "clubs-fill", size: 28 %>
      <strong>Hack Club</strong>
    <% end %>
  </div>
</fieldset>

<template x-if="type == 'first'">
  <div class="field">
    <%= form.label :league, "League" %>
    <%= form.select :league, [["FRC", "frc"], ["FTC", "ftc"], ["FLL", "fll"]], { required: true, include_blank: "Select a league", selected: affiliation.league }, disabled: %>
  </div>
</template>
<template x-if="type == 'first'">
  <div class="field">
    <%= form.label :team_number, "Team number" %>
    <%= form.text_field :team_number, { required: true, placeholder: "9101", value: affiliation.team_number, disabled: } %>
  </div>
</template>
<template x-if="type == 'first'">
  <div class="field">
    <%= form.label :size, "Size" %>
    <div class="flex items-center" x-data="{ people: <%= affiliation.size || "''" %> }">
      <div class="input flex gap-2 items-center justify-between py-0">
        <%= form.number_field :size, placeholder: "10", step: 1, required: true, class: "!p-0 !border-none !shadow-none min-h-auto", disabled:, "x-model": "people" %>
        <span class="bold muted" x-text="people == 1 ? 'person' : 'people'">people</span>
      </div>
    </div>
  </div>
</template>

<template x-if="type == 'vex'">
  <div class="field">
    <%= form.label :league, "League" %>
    <%= form.select :league, [["123", "123"], ["GO", "go"], ["AIM", "aim"], ["IQ", "iq"], ["EXP", "exp"], ["V5", "v5"], ["CTE", "cte"], ["AIR", "air"]], { required: true, include_blank: "Select a league", selected: affiliation.league }, disabled: %>
  </div>
</template>
<template x-if="type == 'vex'">
  <div class="field">
    <%= form.label :team_number, "Team number" %>
    <%= form.text_field :team_number, { required: true, placeholder: "11981B", value: affiliation.team_number, disabled: } %>
  </div>
</template>
<template x-if="type == 'vex'">
  <div class="field">
    <%= form.label :size, "Size" %>
    <div class="flex items-center" x-data="{ people: <%= affiliation.size || "''" %> }">
      <div class="input flex gap-2 items-center justify-between py-0">
        <%= form.number_field :size, placeholder: "10", step: 1, required: true, class: "!p-0 !border-none !shadow-none min-h-auto", disabled:, "x-model": "people" %>
        <span class="bold muted" x-text="people == 1 ? 'person' : 'people'">people</span>
      </div>
    </div>
  </div>
</template>

<template x-if="type == 'hack_club'">
  <div class="field">
    <%= form.label :venue_name, "Venue name" %>
    <%= form.text_field :venue_name, { required: true, placeholder: "Pierson Library", value: affiliation.venue_name, disabled: } %>
  </div>
</template>
<template x-if="type == 'hack_club'">
  <div class="field">
    <%= form.label :size, "Size" %>
    <div class="flex items-center" x-data="{ people: <%= affiliation.size || "''" %> }">
      <div class="input flex gap-2 items-center justify-between py-0">
        <%= form.number_field :size, placeholder: "10", step: 1, required: true, class: "!p-0 !border-none !shadow-none min-h-auto", disabled:, "x-model": "people" %>
        <span class="bold muted" x-text="people == 1 ? 'person' : 'people'">people</span>
      </div>
    </div>
  </div>
</template>

<% if affiliation.new_record? %>
  <div class="flex flex-row items-center justify-between" x-show="type !== ''">
    <%= form.submit "Save affiliation", "x-bind:disabled": "disabled" %>
    <button type="button" class="btn btn-secondary" "x-bind:disabled" : "disabled" x-on:click="type = ''">Cancel</button>
  </div>
<% else %>
  <%= form.submit "Update", "x-bind:disabled": "disabled || type === ''" %>
<% end %>
