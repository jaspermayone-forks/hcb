<tr>
  <td>
    <%= format_date(organizer_position.created_at) %>
    <% if auditor_signed_in? %>
      <br>
      <div class="warning m0">
        Last active:
        <% if organizer_position.user.last_seen_at.present? %>
          <%= format_date(organizer_position.user.last_seen_at) %>
        <% else %>
          unknown
        <% end %>
      </div>
    <% end %>
  </td>
  <td>
    <%= user_mention organizer_position.user %>
  </td>
  <td><%= organizer_position.role.humanize %></td>
  <td>
    <%= copy_to_clipboard(organizer_signed_in? ? organizer_position.user.email : "user@example.com", class: "#{organizer_signed_in? ? "" : "pointer-events-none"} inline-flex items-center g1 line-height-0") do %>
      <%= inline_icon("email", size: 20) %>
      <%= organizer_signed_in? ? organizer_position.user.email : "Hidden" %>
    <% end %>
    <% if auditor_signed_in? %>
      <p class="warning m0">
        <%= copy_to_clipboard(organizer_position.user.phone_number, class: "inline-flex items-center g1 line-height-0") do %>
          <%= inline_icon("message-simple", size: 20) %>
          <%= organizer_position.user.phone_number %>
        <% end %>
      </p>
    <% end %>
  </td>
  <td>
    <div class="flex items-center gap-2 justify-end">
    <% if admin_signed_in? %>
      <div class="line-height-0 tooltipped tooltipped--w" aria-label="<%= (organizer_position.organizer_position_invite.contract.present? ? organizer_position.organizer_position_invite.contract.signed? ? "Contract signee" : "Pending signature, click to manage." : "No contract signature") %>">
        <div class="warning">
          <% if organizer_position.organizer_position_invite.contract&.signed? %>
            <%= link_to organizer_position.organizer_position_invite.contract.document || event_documents_path(event: organizer_position.event), class: "success", data: { turbo_frame: "_top" } do %>
              <%= inline_icon("docs-positive", size: 24) %>
            <% end %>
          <% elsif organizer_position.organizer_position_invite.contract&.present? %>
            <div data-controller="menu" data-menu-placement-value="bottom-start">
              <div class="primary pointer" data-menu-target="toggle" data-action="click->menu#toggle click@document->menu#close keydown@document->menu#keydown">
                <%= inline_icon("clock", size: 24) %>
              </div>
              <div data-menu-target="content" class="menu__content menu__content--2 menu__content--compact">
                <%= link_to void_contract_path(organizer_position.organizer_position_invite.contract), data: { turbo_confirm: "Are you sure you want to void this contract?", turbo_method: :post } do %>
                  Void this contract
                <% end %>
                <% organizer_position.organizer_position_invite.contract.parties.reject { |party| party.role == "hcb" }.each do |party| %>
                  <%= link_to resend_contract_party_path(party), data: { turbo_method: :post } do %>
                    Resend to the <%= party.role %>
                  <% end %>
                <% end %>
              </div>
            </div>
          <% else %>
            <%= link_to "#", class: "warning", data: { behavior: "modal_trigger", modal: "send_contract_#{organizer_position.organizer_position_invite.id}" } do %>
              <%= inline_icon("docs-negative", size: 24) %>
            <% end %>
            <section class="modal modal--scroll bg-snow" data-behavior="modal" role="dialog" id="send_contract_<%= organizer_position.organizer_position_invite.id %>">
              <%= modal_header "Send a contract" %>
              <%= render "organizer_position_invites/contract_form", opi: organizer_position.organizer_position_invite %>
            </section>
          <% end %>
        </div>
      </div>
    <% end %>
    <% if auditor_signed_in? %>
      <div class="tooltipped tooltipped--s" aria-label="Edit user's settings">
        <%= pop_icon_to "settings", admin_user_path(organizer_position.user), data: { turbo_frame: "_top" }, class: "admin-tools overflow-hidden" %>
      </div>
      <% unless organizer_position.user == current_user || current_session&.impersonated? || !admin_signed_in? %>
        <div class="tooltipped tooltipped--s" aria-label="Impersonate user">
          <%= pop_icon_to "spy", impersonate_user_path(id: organizer_position.user.id, return_to: request.url), data: { turbo_method: :post, turbo_frame: "_top" }, class: "admin-tools overflow-hidden" %>
        </div>
      <% end %>
    <% end %>
    <% if policy(organizer_position).view_allowances? %>
      <%= pop_icon_to "payment", event_organizer_position_spending_controls_path(organizer_position_id: organizer_position) %>
    <% end %>
    <% if policy(organizer_position).destroy? %>
      <%= pop_icon_to "member-remove",
                      organizer_path(organizer_position),
                      class: "error",
                      data: {
                        turbo_frame: "_top",
                        turbo_method: :delete,
                        turbo_confirm: "This will revoke their access to this organization. Their cards will be permanently canceled.",
                      } %>
    <% elsif policy(organizer_position.organizer_position_deletion_requests.build).new? %>
      <%= pop_icon_to "member-remove",
                      new_event_organizer_position_remove_path(organizer_position_id: organizer_position.user.slug),
                      class: "error",
                      data: {
                        turbo_frame: "_top",
                        turbo_method: :get
                      } %>
    <% end %>
    </div>
  </td>
</tr>
