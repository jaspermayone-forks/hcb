<%# locals: (announcement:, show_event: false) %>

<div class="relative card flex flex-col gap-2 <%= "border-warning border-solid" if announcement.draft? %> w-full">
  <div class="flex sm:items-center justify-between flex-col sm:flex-row">
    <p class="my-0">
      <%= user_mention announcement.author %>
    </p>
    <% if show_event %>
      <p class="hidden sm:inline my-0 muted">&bull;&nbsp;</p>
      <p class="mb-0 mt-2 sm:!my-0"><%= link_to announcement.event.name, event_announcement_overview_path(announcement.event) %></p>
    <% end %>
    <p class="homepage-eyebrow -order-1 sm:order-1 text-sm text-gray-500 sm:ml-auto mt-1 mb-2 sm:!my-0">
      <%= (announcement.draft? ? announcement.created_at : announcement.published_at).strftime("%B %e, %Y") %>
    </p>
  </div>
  <hr class="my-1 dark:!border-slate border-smoke">
  <div class="flex items-center justify-between">
    <h2 class="font-bold text-2xl my-0 no-underline text-white">
      <% if announcement.draft? %>
        <span class="text-orange border-orange rounded-full border-solid border-[1px] text-sm p-[6px] mr-1 no-underline">Draft</span>
      <% end %>
      <%= link_to announcement.title, announcement_path(announcement), class: "font-bold no-underline text-black dark:text-smoke hover:underline" %>
    </h2>
    <% if organizer_signed_in?(as: :member) && !show_event %>
      <div class="flex gap-2">
        <% if announcement.draft? %>
          <%= pop_icon_to "send", publish_announcement_path(announcement), data: { turbo_confirm: "Are you sure you would like to publish this announcement and notify #{announcement.event.followers.size} #{"follower".pluralize(announcement.event.followers.size)}?", turbo_method: :post }, class: "tooltipped success", "aria-label": "Publish draft", disabled: !policy(announcement).publish? %>
        <% end %>
        <%= pop_icon_to "edit", edit_announcement_path(announcement), class: "tooltipped", "aria-label": "Edit announcement" if policy(announcement).edit? %>
        <%= pop_icon_to "delete", announcement_path(announcement), data: { turbo_confirm: "Are you sure you would like to delete this announcement?", turbo_method: :delete }, class: "error tooltipped", "aria-label": "Delete announcement" if policy(announcement).destroy? %>
      </div>
    <% end %>
  </div>
  <%= render partial: "announcements/announcement_body", locals: { announcement: } %>
</div>
